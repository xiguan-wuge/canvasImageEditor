<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <canvas id="myCanvas" width="600" height="400" style="border:1px solid #000000;"></canvas>
  <script>
    const canvas = document.getElementById('myCanvas');
    const ctx = canvas.getContext('2d');

    let arrow = {
      startX: 100,  // 箭头起点
      startY: 100,
      endX: 200,    // 箭头终点
      endY: 200,
      draggingPoint: null // 当前拖动的点（"start" 或 "end"）
    };

    // 绘制箭头和尾部圆圈
    function drawArrow() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // 计算箭头的方向
      const headlen = 10; // 箭头的长度
      const angle = Math.atan2(arrow.endY - arrow.startY, arrow.endX - arrow.startX);

      // 绘制箭头的主线
      ctx.beginPath();
      ctx.moveTo(arrow.startX, arrow.startY);
      ctx.lineTo(arrow.endX, arrow.endY);
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 2;
      ctx.stroke();

      // 绘制箭头的头部
      ctx.beginPath();
      ctx.moveTo(arrow.endX, arrow.endY);
      ctx.lineTo(arrow.endX - headlen * Math.cos(angle - Math.PI / 6), arrow.endY - headlen * Math.sin(angle - Math.PI / 6));
      ctx.lineTo(arrow.endX - headlen * Math.cos(angle + Math.PI / 6), arrow.endY - headlen * Math.sin(angle + Math.PI / 6));
      ctx.lineTo(arrow.endX, arrow.endY);
      ctx.lineTo(arrow.endX - headlen * Math.cos(angle - Math.PI / 6), arrow.endY - headlen * Math.sin(angle - Math.PI / 6));
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 2;
      ctx.stroke();
      ctx.fillStyle = '#000';
      ctx.fill();

      // 绘制起点的圆圈
      ctx.beginPath();
      ctx.arc(arrow.startX, arrow.startY, 5, 0, Math.PI * 2, true);
      ctx.fillStyle = '#FF0000';
      ctx.fill();

      // 绘制终点的圆圈
      ctx.beginPath();
      ctx.arc(arrow.endX, arrow.endY, 5, 0, Math.PI * 2, true);
      ctx.fillStyle = '#0000FF';
      ctx.fill();
    }

    // 检查鼠标是否在箭头或圆圈附近
    function isMouseNearPoint(x, y, pointX, pointY, radius) {
      const dx = x - pointX;
      const dy = y - pointY;
      return dx * dx + dy * dy <= radius * radius;
    }

    // 鼠标按下事件
    canvas.addEventListener('mousedown', (e) => {
      const mouseX = e.offsetX;
      const mouseY = e.offsetY;

      if (isMouseNearPoint(mouseX, mouseY, arrow.startX, arrow.startY, 10)) {
        arrow.draggingPoint = 'start';
      } else if (isMouseNearPoint(mouseX, mouseY, arrow.endX, arrow.endY, 10)) {
        arrow.draggingPoint = 'end';
      }
    });

    // 鼠标移动事件
    canvas.addEventListener('mousemove', (e) => {
      if (arrow.draggingPoint) {
        const mouseX = e.offsetX;
        const mouseY = e.offsetY;

        if (arrow.draggingPoint === 'start') {
          arrow.startX = mouseX;
          arrow.startY = mouseY;
        } else if (arrow.draggingPoint === 'end') {
          arrow.endX = mouseX;
          arrow.endY = mouseY;
        }

        drawArrow();
      }
    });

    // 鼠标松开事件
    canvas.addEventListener('mouseup', () => {
      arrow.draggingPoint = null;
    });

    // 初始绘制
    drawArrow();
  </script>

</body>

</html>