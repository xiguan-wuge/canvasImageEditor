<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Mosaic Effect</title>
    <style>
        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="800" height="600"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // 你可以通过以下方式加载图像
        const imageSrc =
			'https://cdn.pixabay.com/photo/2024/01/02/10/33/stream-8482939_1280.jpg'; // 替换为你要使用的图片路径
		const image = new Image();
		image.crossOrigin = 'Anonymous'; // 允许跨域访问
		image.src = imageSrc;

        image.onload = function() {
            // 将图像绘制到 Canvas 上
            ctx.drawImage(image, 0, 0, canvas.width, canvas.height);

            // 获取图像数据
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            // 设置马赛克块的大小
            const blockSize = 20;

            // 遍历图像的每个块
            for (let y = 0; y < canvas.height; y += blockSize) {
                for (let x = 0; x < canvas.width; x += blockSize) {
                    // 获取块的颜色（取块的左上角像素颜色）
                    const index = (y * canvas.width + x) * 4;
                    const r = data[index];
                    const g = data[index + 1];
                    const b = data[index + 2];
                    const a = data[index + 3];

                    // 填充块
                    ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${a / 255})`;
                    ctx.fillRect(x, y, blockSize, blockSize);
                }
            }
        };
    </script>
</body>
</html>
