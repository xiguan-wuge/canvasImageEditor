<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Canvas Draw Circle</title>
  <style>
    canvas {
      border: 1px solid black;
    }
  </style>
</head>

<body>
  <canvas id="myCanvas" width="800" height="600"></canvas>

  <script>
    const canvas = document.getElementById('myCanvas');
    const ctx = canvas.getContext('2d');

    let isDrawing = false;
    let startX, startY, endX, endY;
    let inCircle = false

    let circles = []; // 用来存储绘制的圆/椭圆信息

    canvas.addEventListener('mousedown', (e) => {
      startX = e.offsetX;
      startY = e.offsetY;
      // 先判断是否在圆内
      inCircle = false
      for(let i =0, len = circles.length; i< len; i++) {
        let circle = circles[i]
        const distance = ((startX - circle.centerX) ** 2) / (circle.radiusX ** 2) +
          ((startY - circle.centerY) ** 2) / (circle.radiusY ** 2);

        if (distance <= 1) {
          // alert('Mouse is inside the circle/ellipse!');
          console.log('在圆内')
          inCirclen = true
          break;
        }
      }
      // circles.forEach(circle => {
        
      // });
      isDrawing = true;
    });

    canvas.addEventListener('mousemove', (e) => {
      if (!isDrawing) return;

      endX = e.offsetX;
      endY = e.offsetY;

      draw();
    });

    canvas.addEventListener('mouseup', (e) => {
      isDrawing = false;

      // 计算圆/椭圆的参数
      const radiusX = Math.abs(endX - startX) / 2;
      const radiusY = Math.abs(endY - startY) / 2;
      const centerX = (startX + endX) / 2;
      const centerY = (startY + endY) / 2;

      // 保存绘制的圆/椭圆
      circles.push({ centerX, centerY, radiusX, radiusY });

      draw();
    });

    // // 判断鼠标是否在圆内
    // canvas.addEventListener('click', (e) => {
    //   const mouseX = e.offsetX;
    //   const mouseY = e.offsetY;

    //   circles.forEach(circle => {
    //     const distance = ((mouseX - circle.centerX) ** 2) / (circle.radiusX ** 2) +
    //       ((mouseY - circle.centerY) ** 2) / (circle.radiusY ** 2);

    //     if (distance <= 1) {
    //       // alert('Mouse is inside the circle/ellipse!');
    //       console.log('在圆内')
    //     }
    //   });
    // });

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // 绘制所有保存的圆/椭圆
      circles.forEach(circle => {
        ctx.beginPath();
        ctx.ellipse(circle.centerX, circle.centerY, circle.radiusX, circle.radiusY, 0, 0, 2 * Math.PI);
        ctx.stroke();
      });

      // 绘制当前正在绘制的圆/椭圆
      if (isDrawing) {
        const radiusX = Math.abs(endX - startX) / 2;
        const radiusY = Math.abs(endY - startY) / 2;
        const centerX = (startX + endX) / 2;
        const centerY = (startY + endY) / 2;

        ctx.beginPath();
        ctx.ellipse(centerX, centerY, radiusX, radiusY, 0, 0, 2 * Math.PI);
        ctx.stroke();
      }
    }

  </script>
</body>

</html>