<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Canvas Mouse-Draw Arrow</title>
  </head>
  <body>
    <canvas id="myCanvas" width="500" height="500" style="border: 1px solid #000000"></canvas>
    <script>
      const canvas = document.getElementById('myCanvas');
      const ctx = canvas.getContext('2d');
      let isDrawing = false;
      let startX, startY;

      // 绘制渐变线条的箭头
      function drawGradientArrow(ctx, fromX, fromY, toX, toY, startWidth, endWidth) {
        const steps = 300; // 分段数量
        const dx = (toX - fromX) / steps;
        const dy = (toY - fromY) / steps;

        ctx.lineCap = 'round'; // 设置线条端点为圆形

        for (let i = 0; i < steps; i++) {
          const x1 = fromX + i * dx;
          const y1 = fromY + i * dy;
          const x2 = fromX + (i + 1) * dx;
          const y2 = fromY + (i + 1) * dy;

          const lineWidth = startWidth + (endWidth - startWidth) * (i / steps);

          ctx.beginPath();
          ctx.moveTo(x1, y1);
          ctx.lineTo(x2, y2);
          ctx.strokeStyle = '#FF0000';
          ctx.lineWidth = lineWidth;
          ctx.stroke();
        }

        const angle = Math.atan2(toY - fromY, toX - fromX);
        const headLength = endWidth * 2;

        ctx.beginPath();
        ctx.moveTo(toX, toY);
        ctx.lineTo(
          toX - headLength * Math.cos(angle - Math.PI / 6),
          toY - headLength * Math.sin(angle - Math.PI / 6)
        );
        ctx.lineTo(
          toX - headLength * Math.cos(angle + Math.PI / 6),
          toY - headLength * Math.sin(angle + Math.PI / 6)
        );
        ctx.lineTo(toX, toY);
        ctx.lineTo(
          toX - headLength * Math.cos(angle - Math.PI / 6),
          toY - headLength * Math.sin(angle - Math.PI / 6)
        );
        ctx.strokeStyle = '#FF0000';
        ctx.lineWidth = endWidth;
        ctx.stroke();
        ctx.fillStyle = '#FF0000';
        ctx.fill();
      }

      // 鼠标按下事件
      canvas.addEventListener('mousedown', function (e) {
        isDrawing = true;
        startX = e.offsetX;
        startY = e.offsetY;
        ctx.clearRect(0, 0, canvas.width, canvas.height); // 清除画布
      });

      // 鼠标移动事件
      canvas.addEventListener('mousemove', function (e) {
        if (isDrawing) {
          const endX = e.offsetX;
          const endY = e.offsetY;
          ctx.clearRect(0, 0, canvas.width, canvas.height); // 清除画布
          drawGradientArrow(ctx, startX, startY, endX, endY, 1, 8); // 动态绘制箭头
        }
      });

      // 鼠标抬起事件
      canvas.addEventListener('mouseup', function (e) {
        if (isDrawing) {
          const endX = e.offsetX;
          const endY = e.offsetY;
          isDrawing = false;
          ctx.clearRect(0, 0, canvas.width, canvas.height); // 清除画布
          drawGradientArrow(ctx, startX, startY, endX, endY, 1, 8); // 最终绘制箭头
        }
      });

      // 鼠标离开画布事件
      canvas.addEventListener('mouseleave', function () {
        isDrawing = false;
      });
    </script>
  </body>
</html>
