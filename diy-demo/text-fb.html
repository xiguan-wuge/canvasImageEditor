<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Text Editing</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
        }
        canvas {
            border: 1px solid #ccc;
        }
        textarea {
            font-family: Arial, sans-serif;
            padding: 0;
            margin: 0;
            border: none;
            outline: none;
            resize: none;
            overflow: hidden;
            background: transparent;
            position: absolute;
            opacity: 0; /* 隐藏 textarea */
        }
    </style>
</head>
<body>

<canvas id="myCanvas" width="600" height="400"></canvas>
<textarea id="textEditor"></textarea>

<script>
    const canvas = document.getElementById('myCanvas');
    const ctx = canvas.getContext('2d');
    const textarea = document.getElementById('textEditor');

    let textBlock = {
        text: 'Click to edit text',
        x: 50,
        y: 50,
        width: 200,
        height: 100,
        fontSize: 20,
        color: 'black',
        scale: 1
    };

    function drawTextBlock() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        ctx.translate(textBlock.x, textBlock.y);
        ctx.scale(textBlock.scale, textBlock.scale);
        ctx.font = `${textBlock.fontSize}px Arial`;
        ctx.fillStyle = textBlock.color;
        const lines = textBlock.text.split('\n');
        for (let i = 0; i < lines.length; i++) {
            ctx.fillText(lines[i], 0, (i + 1) * textBlock.fontSize);
        }
        ctx.strokeStyle = 'rgba(0,0,0,0.5)';
        ctx.strokeRect(0, 0, textBlock.width, textBlock.height);
        ctx.restore();
    }

    drawTextBlock();

    canvas.addEventListener('dblclick', function(event) {
        const rect = canvas.getBoundingClientRect();
        const x = (event.clientX - rect.left) / textBlock.scale;
        const y = (event.clientY - rect.top) / textBlock.scale;

        if (x >= textBlock.x && x <= textBlock.x + textBlock.width &&
            y >= textBlock.y && y <= textBlock.y + textBlock.height) {
            
            textarea.style.left = `${rect.left + textBlock.x * textBlock.scale}px`;
            textarea.style.top = `${rect.top + textBlock.y * textBlock.scale}px`;
            textarea.style.width = `${textBlock.width * textBlock.scale}px`;
            textarea.style.height = `${textBlock.height * textBlock.scale}px`;
            textarea.style.fontSize = `${textBlock.fontSize * textBlock.scale}px`;
            textarea.style.color = textBlock.color;
            textarea.value = textBlock.text;
            textarea.style.opacity = 1; // 显示 textarea
            textarea.focus();
        }
    });

    textarea.addEventListener('input', function() {
        textBlock.text = textarea.value;
        drawTextBlock();
    });

    textarea.addEventListener('blur', function() {
        textarea.style.opacity = 0; // 隐藏 textarea
    });

    document.addEventListener('keydown', function(event) {
        if (event.key === '+' || event.key === '-') {
            const scaleStep = event.key === '+' ? 0.1 : -0.1;
            textBlock.scale += scaleStep;
            drawTextBlock();
        }
    });
</script>

</body>
</html>
