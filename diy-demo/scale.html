<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Zoom</title>
    <style>
        canvas {
            border: 1px solid black;
            cursor: grab;
        }
    </style>
</head>
<body>
    <p>
        <button id="enlarge">放大</button>
        <button id="reduce">缩小</button>
    </p>
   

    <canvas id="myCanvas" width="800" height="600"></canvas>

    <script>
        
        let scale = 1.0;  // 初始缩放比例
        let originX = 0;  // 平移的X偏移量
        let originY = 0;  // 平移的Y偏移量

        const enlargeBtn = document.getElementById('enlarge');
        const reduceBtn = document.getElementById('reduce');
        enlargeBtn.addEventListener('click', () => {
            scale += 0.1
            console.log('scale++', scale);
            draw()
        })
        reduceBtn.addEventListener('click', () => {
            scale -= 0.1
            console.log('scale--', scale);
            draw()
        })
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');
        const imageSrc =
			'https://cdn.pixabay.com/photo/2024/01/02/10/33/stream-8482939_1280.jpg'; // 替换为你要使用的图片路径
		const img = new Image();
		img.crossOrigin = 'Anonymous'; // 允许跨域访问
		img.src = imageSrc;

		img.onload = function () {
			ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            // draw();
			// saveAction(); // 保存初始状态
		};


        // 初始绘制内容
        function draw() {
            console.log('scale', scale);
            console.log('originX,Y', originX, originY);
            ctx.clearRect(0, 0, canvas.width, canvas.height); // 清空画布

            ctx.save();  // 保存当前状态
            ctx.translate(originX, originY); // 先平移
            ctx.scale(scale, scale);  // 缩放画布

            // 在这里绘制你的内容
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'blue';
            ctx.fillRect(100, 100, 200, 200);  // 示例：一个蓝色的矩形
            ctx.fillStyle = 'red';
            ctx.font = '30px Arial';
            ctx.fillText('Zoom Me!', 150, 200);  // 示例：一些文本

            ctx.restore();  // 恢复到之前的状态
        }

        draw();

        // 处理鼠标滚轮缩放
        canvas.addEventListener('wheel', (event) => {
            event.preventDefault();  // 阻止默认滚动行为

            const scaleAmount = 1.1;
            const mouseX = event.clientX - canvas.getBoundingClientRect().left;
            const mouseY = event.clientY - canvas.getBoundingClientRect().top;

            if (event.deltaY < 0) {
                // 放大
                scale *= scaleAmount;

                // 调整平移，使缩放中心位于鼠标位置
                originX = mouseX - (mouseX - originX) * scaleAmount;
                originY = mouseY - (mouseY - originY) * scaleAmount;
            } else {
                // 缩小
                scale /= scaleAmount;

                // 调整平移，使缩放中心位于鼠标位置
                originX = mouseX - (mouseX - originX) / scaleAmount;
                originY = mouseY - (mouseY - originY) / scaleAmount;
            }
            console.log();

            draw();
        });

        // 处理拖动画布（平移）
        let isDragging = false;
        let lastX = 0;
        let lastY = 0;

        canvas.addEventListener('mousedown', (event) => {
            isDragging = true;
            lastX = event.clientX;
            lastY = event.clientY;
            canvas.style.cursor = 'grabbing';
        });

        canvas.addEventListener('mousemove', (event) => {
            if (isDragging) {
                const deltaX = event.clientX - lastX;
                const deltaY = event.clientY - lastY;

                originX += deltaX;
                originY += deltaY;

                lastX = event.clientX;
                lastY = event.clientY;

                draw();
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDragging = false;
            canvas.style.cursor = 'grab';
        });

        canvas.addEventListener('mouseleave', () => {
            isDragging = false;
            canvas.style.cursor = 'grab';
        });
    </script>
</body>
</html>
